<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)" [disabled]="updatingArticles || filtersLoading">
    <ion-refresher-content  
      pullingIcon="chevron-down-outline"
      refreshingSpinner="circles"
      refreshingText="Loading articles from the last 3 days">
    </ion-refresher-content>
  </ion-refresher>

  <div [hidden]="updatingArticles" class="pulldown-text  ion-text-center">
    <p>Pull down the feed to get the latest articles</p>
  </div>

  <ion-list id="feed">
    <ion-card [hidden]="displayArticles.length === 0" *ngFor="let article of displayArticles; let i = index" id="{{i}}" attr.id="{{i}}">
      <div class="ion-activatable tappable ion-no-margin ion-no-padding" (click)="onArticleSelected(i)" [hidden]="i === openArticleIndex">
        <ion-ripple-effect type="unbound"></ion-ripple-effect>
        <ion-row>
          <ion-col size="11" class="ion-no-margin ion-no-padding">
            <div class="title">
              <h1 class="two-line-wrap">{{ article.title }}</h1>
            </div>
          </ion-col>
          <ion-col size="1" class="ion-text-end">
            <ion-icon name="chevron-down-outline"></ion-icon>
          </ion-col>
        </ion-row>
      </div>
    
      <div class="ion-activatable tappable ion-no-margin ion-no-padding" (click)="onArticleSelected(i)" [hidden]="i !== openArticleIndex">

        <ion-ripple-effect type="unbound"></ion-ripple-effect>
        <ion-row>
          <ion-col size="11" class="ion-no-margin ion-no-padding">
            <div class="title">
              <h1 class="four-line-wrap">{{ article.title }}</h1>
            </div>
          </ion-col>
          <ion-col size="1" class="ion-text-end">
            <ion-icon name="chevron-up-outline"></ion-icon>
          </ion-col>
        </ion-row>
      </div>

      <ion-card-content class="ion-no-margin ion-no-padding">
        <app-article *ngIf="i === openArticleIndex"
          [article]="article">
        </app-article>

        <ion-row class="ion-justify-content-between footer" (click)="onArticleSelected(i)">
          <ion-row class="ion-justify-content-start">
            <ion-label>{{ article.displaySourceTitle }}</ion-label>
          </ion-row>

          <ion-row class="ion-justify-content-end">
            <ion-label>{{ getArticleAge(article.displayDateTime ? article.displayDateTime : article.datePublished) }}</ion-label>
          </ion-row>
        </ion-row>
      </ion-card-content>
    </ion-card>

    <div [hidden]="displayArticles.length !== 0 || updatingArticles" class="ion-text-center">
      <h2>Could not find any articles. It is likely your filters are too strict.</h2>
    </div>
    <div [hidden]="!updatingArticles" class="ion-text-center">
      <h2>Loading articles...</h2>
    </div>
  </ion-list>

  <ion-fab vertical="bottom" horizontal="center" slot="fixed" *ngIf="showRefreshFab" [disabled]="updatingArticles || filtersLoading" [@btnInBottom]>
    <ion-fab-button (click)="doRefresh()">
      <ion-icon size="large" name="refresh"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <ion-fab vertical="center" horizontal="start" slot="fixed" *ngIf="!filtersSaved" [@btnInLeft]>
    <ion-fab-button (click)="saveFilters()" color="primary" [disabled]="updatingArticles || filtersLoading">
      <ion-icon size="large" name="save"></ion-icon>
    </ion-fab-button>

    <ion-fab-button (click)="loadFilters()" color="danger" style="margin-top: 10px;" [disabled]="updatingArticles || filtersLoading">
      <ion-icon size="large" name="close-circle"></ion-icon>
    </ion-fab-button>
  </ion-fab>
      
  <ion-infinite-scroll (ionInfinite)="getNextPage($event)" threshold="5%" [disabled]="updatingArticles || filtersLoading" [hidden]="nextToken === null">
    <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading more articles...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
  <div [hidden]="nextToken !== null || updatingArticles || displayArticles.length === 0" class="ion-text-center">
    <h2>You're all caught up!</h2>
  </div>

  <div class="spinner-container" *ngIf="showErrorSpinner">
    <ion-spinner class="spinner" name="crescent" color="danger"></ion-spinner>
  </div>
</ion-content>
