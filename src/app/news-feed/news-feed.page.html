<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start" class="left-buttons" *ngIf="authService.loaded">
        <ion-button (click)="toggleMenu()" *ngIf="!menuStatus || platformWidth < 720">
          <ion-icon name="options" slot="icon-only"></ion-icon>
        </ion-button>
      <ion-label class="hide-label" *ngIf="!menuStatus || platformWidth < 720" color="primary">Filter Menu</ion-label>
    </ion-buttons>
    
    <ion-title>
      <ion-img class="logo" src="../../assets/img/logo/neutrify-logo-v2.png"></ion-img>
    </ion-title>

    <ion-buttons slot="end" class="right-buttons" *ngIf="authService.loaded">
      <ion-label class="hide-label" color="primary">Main Menu</ion-label>
      <ion-menu-button menu="mainMenu" slot="end"></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)" [disabled]="updatingArticles">
    <ion-refresher-content
      pullingIcon="refresh"
      refreshingSpinner="crescent">
    </ion-refresher-content>
  </ion-refresher>

  <div [hidden]="updatingArticles" class="pulldown-text ion-text-center">
    <p>Pull down the feed to get the latest articles</p>
  </div>

  <ion-row [hidden]="!updatingArticles && displayArticles.length !== 0" class="ion-justify-content-center">
    <ion-skeleton-text animated style="width: 240px; line-height: 16px; margin-top: 5px;"></ion-skeleton-text>
  </ion-row>

  <ion-list id="feed">
    <ion-card [hidden]="displayArticles.length === 0" *ngFor="let article of displayArticles; let i = index" id="{{i}}" attr.id="{{i}}">
      <div class="ion-activatable tappable ion-no-margin ion-no-padding" (click)="onArticleSelected(i)" [hidden]="i === openArticleIndex">
        <ion-ripple-effect type="unbound"></ion-ripple-effect>
        <ion-row>
          <ion-col size="11" class="ion-no-margin ion-no-padding title">
            <h1 class="two-line-wrap"><b>{{ article.title }}</b></h1>
          </ion-col>
          <ion-col size="1" class="ion-text-end">
            <ion-icon name="chevron-down-outline"></ion-icon>
          </ion-col>
        </ion-row>
      </div>
    
      <div class="ion-activatable tappable ion-no-margin ion-no-padding" (click)="onArticleSelected(i)" [hidden]="i !== openArticleIndex">

        <ion-ripple-effect type="unbound"></ion-ripple-effect>
        <ion-row>
          <ion-col size="11" class="ion-no-margin ion-no-padding title">
            <h1 class="four-line-wrap"><b>{{ article.title }}</b></h1>
          </ion-col>
          <ion-col size="1" class="ion-text-end">
            <ion-icon name="chevron-up-outline"></ion-icon>
          </ion-col>
        </ion-row>
      </div>

      <ion-card-content class="ion-no-margin ion-no-padding">
        <app-article *ngIf="i === openArticleIndex"
          [article]="article">
        </app-article>

        <ion-row class="ion-justify-content-between footer" (click)="onArticleSelected(i)">
          <ion-row class="ion-justify-content-start">
            <ion-label>{{ article.displaySourceTitle }}</ion-label>
          </ion-row>

          <ion-row class="ion-justify-content-end">
            <ion-label>{{ getArticleAge(article.displayDateTime ? article.displayDateTime : article.datePublished) }}</ion-label>
          </ion-row>
        </ion-row>
      </ion-card-content>
    </ion-card>

    <app-skeleton-feed [hidden]="!updatingArticles"></app-skeleton-feed>

    <div [hidden]="displayArticles.length !== 0 || updatingArticles" class="ion-text-center">
      <h2>Could not find any articles. It is likely your filters are too strict.</h2>
    </div>
  </ion-list>

  <ion-infinite-scroll (ionInfinite)="getNextPage($event)" threshold="5%" [disabled]="updatingArticles" [hidden]="nextToken === null">
    <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading more articles...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>

  <div [hidden]="nextToken !== null || updatingArticles || displayArticles.length === 0" class="ion-text-center">
    <h2>You're all caught up!</h2>
  </div>
</ion-content>

<ion-fab vertical="bottom" horizontal="center" slot="fixed" *ngIf="showRefreshFab" [disabled]="updatingArticles || filtersLoading" [@btnInBottom]>
  <ion-fab-button (click)="doRefresh()">
    <ion-icon size="large" name="refresh"></ion-icon>
  </ion-fab-button>
</ion-fab>

<ion-fab vertical="center" horizontal="start" slot="fixed" *ngIf="!filtersSaved" [@btnInLeft]>
  <ion-fab-button (click)="saveFilters()" color="primary" [disabled]="updatingArticles || filtersLoading">
    <ion-icon size="large" name="save"></ion-icon>
  </ion-fab-button>

  <ion-fab-button (click)="loadFilters()" color="danger" style="margin-top: 10px;" [disabled]="updatingArticles || filtersLoading">
    <ion-icon size="large" name="close-circle"></ion-icon>
  </ion-fab-button>
</ion-fab>